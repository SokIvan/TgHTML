<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–µ –ø–µ—Ä–≤–æ–µ Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding: 20px;
            text-align: center;
            background-color: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #222);
        }
        button {
            background-color: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #fff);
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 18px;
            margin: 10px;
            cursor: pointer;
        }
        .debug {
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            margin: 20px 0;
            text-align: left;
            font-family: monospace;
            color: #333;
        }
    </style>
</head>
<body>
    <h1>–ü—Ä–∏–≤–µ—Ç –∏–∑ Mini App!</h1>
    
    <div id="user-info" class="debug">
        –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...
    </div>
    
    <div id="app-status" class="debug">
        –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...
    </div>
    
    <button onclick="sendDataToBot()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É</button>
    <button onclick="testWebApp()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å WebApp</button>
    <button onclick="closeApp()">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç WebApp
        const tg = window.Telegram.WebApp;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(message) {
            document.getElementById('app-status').innerHTML += `<br>‚û°Ô∏è ${message}`;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateStatus('WebApp –æ–±—ä–µ–∫—Ç –ø–æ–ª—É—á–µ–Ω');
        
        // –ì–æ–≤–æ—Ä–∏–º Telegram, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
        tg.ready();
        updateStatus('tg.ready() –≤—ã–∑–≤–∞–Ω');
        
        // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        tg.expand();
        updateStatus('tg.expand() –≤—ã–∑–≤–∞–Ω');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫ –æ—Ç–∫—Ä—ã—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        const initData = tg.initData;
        const initDataUnsafe = tg.initDataUnsafe;
        
        updateStatus(`initData —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: ${!!initData}`);
        updateStatus(`initDataUnsafe —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: ${!!initDataUnsafe}`);

        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        const user = tg.initDataUnsafe?.user;
        const userDiv = document.getElementById('user-info');
        
        if (user) {
            userDiv.innerHTML = `
                <strong>‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–µ–Ω—ã:</strong><br>
                ID: ${user.id}<br>
                –ò–º—è: ${user.first_name} ${user.last_name || ''}<br>
                Username: ${user.username || '–Ω–µ—Ç'}<br>
                –Ø–∑—ã–∫: ${user.language_code || '–Ω–µ—Ç'}<br>
                <br>
                <strong>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
                initDataUnsafe: ${JSON.stringify(tg.initDataUnsafe, null, 2)}
            `;
            updateStatus('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
        } else {
            userDiv.innerHTML = '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É Menu –≤ Telegram!';
            updateStatus('‚ö†Ô∏è –ù–ï–¢ –î–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
        function sendDataToBot() {
            updateStatus('–ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö...');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –º–µ—Ç–æ–¥ sendData
                if (!tg.sendData) {
                    updateStatus('‚ùå –û—à–∏–±–∫–∞: –º–µ—Ç–æ–¥ sendData –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                    alert('–û—à–∏–±–∫–∞: –º–µ—Ç–æ–¥ sendData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ —á–µ—Ä–µ–∑ Telegram?');
                    return;
                }
                
                // –°–æ–∑–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
                const data = {
                    action: 'button_pressed',
                    message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –Ω–∞ –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É!',
                    user_id: user?.id,
                    timestamp: new Date().toISOString()
                };
                
                const jsonString = JSON.stringify(data);
                updateStatus(`–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ: ${jsonString}`);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º
                tg.sendData(jsonString);
                
                updateStatus('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!');
                // –ü–æ—Å–ª–µ sendData –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                
            } catch (error) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: ${error.message}`);
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        // –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è
        function testWebApp() {
            updateStatus('--- –¢–ï–°–¢–û–í–ê–Ø –ü–†–û–í–ï–†–ö–ê ---');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã
            const methods = [];
            for (let prop in tg) {
                if (typeof tg[prop] === 'function') {
                    methods.push(prop);
                }
            }
            updateStatus(`–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã: ${methods.join(', ')}`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞
            updateStatus(`version: ${tg.version}`);
            updateStatus(`platform: ${tg.platform}`);
            updateStatus(`colorScheme: ${tg.colorScheme}`);
            updateStatus(`isExpanded: ${tg.isExpanded}`);
            updateStatus(`viewportHeight: ${tg.viewportHeight}`);
            
            alert('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –°–º–æ—Ç—Ä–∏ —Å—Ç–∞—Ç—É—Å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.');
        }

        function closeApp() {
            tg.close();
        }
    </script>
</body>
</html>
